<div align="center">

<img width="360" src="./logo.png" alt="logo">

# craby

Type-safe Rust for React Native TurboModulesâ€”auto-generated, fully integrated

</div>

> [!NOTE]
> This project is under development

## Overview

**craby** is a type-safe Rust development tool for React Native TurboModules. It automatically generates Rust code based on TypeScript/Flow schemas and provides fully integrated Android/iOS native bindings.

### Key Features

- ğŸ”„ **Auto Code Generation**: Automatically generate Rust code from TypeScript/Flow TurboModule schemas
- ğŸ›¡ï¸ **Type Safety**: Prevent runtime errors with compile-time type validation
- ğŸ“± **Cross-Platform**: Support for both Android and iOS
- âš¡ **High Performance**: Optimized performance with Rust-written native code
- ğŸ”§ **Developer Experience**: Simple CLI commands for project setup and building

## Quick Start

### Prerequisites

Before using Craby, you need an existing React Native TurboModule project with:

- TypeScript/Flow TurboModule spec files
- Proper `codegenConfig` in `package.json`

### Installation

```bash
# NPM
npm install --dev @craby/cli

# pnpm
pnpm install --dev @craby/cli

# Yarn
yarn add --dev @craby/cli
```

### Setup

```bash
# In your existing React Native TurboModule project root
craby init
```

This adds Rust capabilities to your existing project.

```bash
# Generates Rust code based on your TurboModule schemas.
craby codegen

# Compiles your Rust code into native binaries for Android and iOS.
craby build
```

## Commands

### `craby init`

Scaffolds Rust integration into an existing React Native TurboModule project. This command:

- Creates Rust crate structure (`crates/*`)
- Integrates Rust toolchain into your existing project

### `craby codegen`

Generates Rust code based on your TypeScript/Flow TurboModule schemas. This command:

- Analyzes your TurboModule spec files
- Generates corresponding Rust function signatures
- Generates native bindings for Android and iOS

### `craby build`

Compiles Rust code and generates native binaries.

### `craby show`

Displays project information and schemas.

### `craby doctor`

Checks project configuration and dependencies.

### `craby clean`

Cleans up temporary generated files.

## Project Structure

After running `craby init`, your project structure will look like this:

```
your-turbo-module/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts
â”‚   â””â”€â”€ NativeModule.ts
â”œâ”€â”€ crates/               # Generated by Craby ğŸ¦€
â”‚   â”œâ”€â”€ lib/              # Common Rust library
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib.rs    # Auto-generated from your schema
â”‚   â”‚       â””â”€â”€ impls.rs  # Your Rust implementation
â”‚   â”œâ”€â”€ android/          # Android native bindings
â”‚   â””â”€â”€ ios/              # iOS native bindings
â”œâ”€â”€ android/
â”œâ”€â”€ ios/
â”œâ”€â”€ Cargo.toml            # Root Rust workspace
â”œâ”€â”€ rust-toolchain.toml   # Rust toolchain configuration
â””â”€â”€ package.json
```

## Examples

```typescript
// src/NativeModule.ts
import type { TurboModule } from 'react-native';
import { TurboModuleRegistry } from 'react-native';

export interface Spec extends TurboModule {
  add(a: number, b: number): number;
  subtract(a: number, b: number): number;
}

export default TurboModuleRegistry.getEnforcing<Spec>('Calculator');
```

```typescript
// src/index.ts
import Calculator from './NativeCalculator';

export function add(a: number, b: number): number {
  return Calculator.add(a, b);
}

export function subtract(a: number, b: number): number {
  return Calculator.subtract(a, b);
}
```

After running `craby codegen`, you'll get:

```rust
// crates/lib/src/lib.rs (auto-generated)
pub mod calculator {
    use crate::impls;

    pub fn add(a: f64, b: f64) -> f64 {
        impls::add(a, b)
    }

    pub fn subtract(a: f64, b: f64) -> f64 {
        impls::subtract(a, b)
    }
}

mod impls;
```

```rust
// crates/lib/src/impls.rs (you implement this)
pub fn add(a: f64, b: f64) -> f64 {
    a + b
}

pub fn subtract(a: f64, b: f64) -> f64 {
    a - b
}
```

### Android Setup and Usage

Open `android/build.gradle` file and add the following line:

```java
android {
  // ...

  sourceSets {
    main {
      // Add this line
      jniLibs.srcDirs += ["src/main/jniLibs"]
    }
  }
}
```

```kotlin
@ReactModule(name = MathModule.NAME)
class MathModule(reactContext: ReactApplicationContext) :
  NativeMathModuleSpec(reactContext) {

  init {
    // Load static library to use native methods
    System.loadLibrary("caculator")
  }

  // Declare the native method
  private external fun nativeAdd(a: Double, b: Double): Double

  // ...

  override fun add(a: Double, b: Double): Double {
    // Call the native method
    return nativeAdd(a, b);
  }
}
```

### iOS Setup and Usage

Open `<ModuleName>.podspec` file and add the following line:

```rb
Pod::Spec.new do |s|
  # Add this line to use Rust module
  s.vendored_frameworks = "ios/framework/libcalculator.xcframework"
end
```

```objc
import "CalculatorModule.h"
import "libcalculator.h" // Add this line

@implementation MathModule
RCT_EXPORT_MODULE()

- (NSNumber *)add:(double *)a b:(double *)b {
  // Call the native method
  NSNumber *result = @(add(a, b));
  return result;
}

// ...

@end
```

## Development Environment

### Requirements

- Node.js 18+
- Rust (latest stable version)

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.
